#!/usr/bin/env bash

# -----------------------------------------------------------------------------
# CONFIG
# -----------------------------------------------------------------------------

__VERSION="1.2"
__NAME="Faker in Bash (Pure)"
__FILE="${0##*/}"
__DIR="${0%/*}"
[[ "$__DIR" == "$0" ]] && __DIR="."
readonly __VERSION __FILE __NAME __DIR

# Default options
o_locale="en"
o_count=1
o_seed=""


function help {
    : <<'DOC'
Displays help information.
DOC
    cat <<EOF
$__NAME v $__VERSION
Usage: $__FILE [options] <task> [args]

Tasks:
   firstname       Generates a random first name (male, female)
   lastname        Generates a random last name (male, female)
   person          Generates a full name (alias: name)
   country         Generates a random country name
   country_abbr    Generates a random country abbreviation
   city            Generates a random city name
   street_name     Generates a random street name
   number          Generates a random number (min, max)
   postcode        Generates a random 5-digit postcode
   job_title       Generates a random job title
   email           Generates a random e-mail address
   phone_number    Generates a random phone number
   company         Generates a random company name
   url             Generates a random URL
   uuid            Generates a random UUID v4
   date            Generates a random date (before, after)
   time            Generates a random time
   lorem           Generates random lorem ipsum words
   help            Displays this help information

Options:
   --locale <lang> Set the locale (default: en)
   --count <num>   Generate multiple items (default: 1)
   --seed <val>    Seed the random number generator for reproducible results

Example:
   $ ./fake person --locale pl --count 5
   $ ./fake uuid --seed 123
EOF
}

# -----------------------------------------------------------------------------
# MAIN
# -----------------------------------------------------------------------------

_RET=""
_DIRECT_CALL=1

# Load libraries
for lib in "$__DIR/lib"/*.sh; do
    source "$lib"
done

# Parse options
_args=()
while [[ $# -gt 0 ]]; do
    case "$1" in
        --locale) o_locale="$2"; shift 2 ;;
        --count)  o_count="$2";  shift 2 ;;
        --seed)   o_seed="$2";   RANDOM="$2"; shift 2 ;;
        *)        _args+=("$1"); shift ;;
    esac
done
set -- "${_args[@]}"

cmd="${1:-help}"

if declare -F "$cmd" >/dev/null && [[ ! "$cmd" =~ ^_ ]]; then
    shift
    # Bulk generation support
    for (( i=0; i<o_count; i++ )); do
        "$cmd" "$@"
    done
else
    help
fi
